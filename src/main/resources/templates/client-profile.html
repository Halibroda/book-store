<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="uk">
<head th:replace="~{fragments/_head :: head(#{nav.profile})}"></head>
<body>
<div th:replace="~{fragments/_navbar :: navbar}"></div>

<main class="container container--narrow">
    <h1 th:text="#{nav.profile}">Мій профіль</h1>

    <!-- флеш-повідомлення -->
    <div th:if="${success}" class="alert alert-success" th:text="${success}">Дані оновлено</div>
    <div th:if="${error}"   class="alert alert-danger"  th:text="${error}">Сталася помилка</div>
    <div th:if="${info}"    class="alert alert-info"    th:text="${info}">Інформація</div>

    <section class="card" style="margin-bottom:1rem;">
        <div class="card__body">
            <p><strong th:text="#{profile.email}">Email</strong>:
                <span th:text="${client.email}">user@example.com</span></p>
            <p><strong th:text="#{profile.name}">Ім’я</strong>:
                <span th:text="${client.name}">User</span></p>
            <p><strong th:text="#{profile.balance}">Баланс</strong>:
                <span th:text="${#numbers.formatDecimal(client.balance,1,'COMMA',2,'POINT')}">0.00</span></p>
        </div>
    </section>

    <form th:action="@{/clients/me}" method="post" class="form" th:object="${form}">
        <input type="hidden" th:if="${_csrf}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <input type="hidden" th:field="*{email}"/>

        <input type="hidden" th:field="*{enabled}"/>

        <div class="form__row">
            <label for="name" th:text="#{profile.name}">Ім’я</label>
            <input id="name" type="text" th:field="*{name}" required/>
            <p class="form__error" th:if="${#fields.hasErrors('name')}" th:errors="*{name}">Помилка</p>
        </div>

        <div class="form__row">
            <label for="balance" th:text="#{profile.balance}">Баланс</label>
            <input id="balance" type="number" step="0.01" min="0" th:field="*{balance}" required/>
            <p class="form__error" th:if="${#fields.hasErrors('balance')}" th:errors="*{balance}">Помилка</p>
        </div>

        <div class="form__actions">
            <button class="btn" th:text="#{common.save}">Зберегти</button>
        </div>
    </form>

    <form th:action="@{/clients/me/delete}" method="post" style="margin-top:1rem;">
        <input type="hidden" th:if="${_csrf}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <button class="btn btn--danger"
                th:text="#{profile.delete}"
                th:onclick="|return confirm('#{profile.delete.confirm}')|">
            Видалити акаунт
        </button>
    </form>
</main>
</body>
</html>
